function initMap(){map||(map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:0,lng:0}}),directionsService=new google.maps.DirectionsService,directionsRenderer=new google.maps.DirectionsRenderer({map:map}))}function loadRoute(n,t){initMap();const i=document.getElementById("map"),r=document.getElementById("close-map-btn");i.style.display="block";r.style.display="block";navigator.geolocation?navigator.geolocation.getCurrentPosition(function(i){const r={lat:i.coords.latitude,lng:i.coords.longitude},u={lat:parseFloat(n),lng:parseFloat(t)};map.setCenter(r);const f={origin:r,destination:u,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(f,function(n,t){t===google.maps.DirectionsStatus.OK?directionsRenderer.setDirections(n):alert("Route not available: "+t)})},function(){alert("Unable to retrieve your location. Please enable location access.")}):alert("Geolocation is not supported by your browser.")}function closeMap(){const n=document.getElementById("map"),t=document.getElementById("close-map-btn");n.style.display="none";t.style.display="none";directionsRenderer&&directionsRenderer.set("directions",null)}function toggleActive(n,t){const i=document.getElementById(n),r=document.getElementById(t);document.getElementById(t).classList.remove("bg-orange-500","text-white");document.getElementById(t).classList.add("border-orange-500","text-orange-500");document.getElementById(n).classList.add("bg-orange-500","text-white");document.getElementById(n).classList.remove("border-orange-500","text-orange-500")}function previewImage(n){const t=new FileReader;t.onload=function(){const n=document.getElementById("profileImagePreview");n.src=t.result};n.target.files&&n.target.files[0]&&t.readAsDataURL(n.target.files[0])}function filterCities(){const n=document.getElementById("searchBar").value.toLowerCase(),t=document.querySelectorAll(".city-card");t.forEach(t=>{const i=t.querySelector("span").textContent.toLowerCase();t.style.display=i.includes(n)?"block":"none"})}function clearFilter(){document.getElementById("searchBar").value="";filterCities()}let map,directionsService,directionsRenderer;document.addEventListener("DOMContentLoaded",function(){function f(){const n=Math.floor(t/60),s=t%60;e.textContent=`OTP expires in: ${n}m ${s}s`;t>0?(t--,u=setTimeout(f,1e3)):(e.textContent="OTP has expired. Please request a new one.",o.disabled=!0,r.disabled=!0,r.classList.add("button-disabled"),i.disabled=!1)}const s=document.getElementById("expirationCountDown");let t=parseInt(s.dataset.otpCount,10),u=0;const e=document.getElementById("otp-timer"),i=document.getElementById("resendOtpButton"),n=document.getElementById("resendMessage"),o=document.getElementById("otp"),r=document.getElementById("verifyButton");f();i.addEventListener("click",function(){u&&clearTimeout(u);const e=document.getElementById("emailInput").value;if(!e){n.textContent="Email is required to resend OTP.";n.classList.remove("text-green-500");n.classList.add("text-danger");return}i.disabled=!0;n.textContent="Resending OTP...";n.classList.remove("text-danger","text-green-500");n.classList.add("text-gray-600");fetch("/Account/ResendOtp",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`email=${encodeURIComponent(e)}`}).then(n=>n.json()).then(i=>{i.success?(n.textContent="OTP resent successfully.",n.classList.remove("text-danger"),n.classList.add("text-green-500"),t=600,o.disabled=!1,r.disabled=!1,r.classList.remove("button-disabled"),f()):(n.textContent=i.message||"Error resending OTP.",n.classList.add("text-danger"))}).catch(t=>{console.error("Error:",t),n.textContent="An error occurred while resending OTP.",n.classList.add("text-danger")}).finally(()=>{i.disabled=!1})})});window.onload=function(){const t=new URLSearchParams(window.location.search),n=t.get("type");n==="owner"?toggleActive("ownerButton","riderButton"):n==="rider"&&toggleActive("riderButton","ownerButton")};document.getElementById("rejectButton").addEventListener("click",function(){document.getElementById("rejectionReasonContainer").classList.remove("hidden")});document.addEventListener("DOMContentLoaded",async function(){const n="@User.FindFirstValue(ClaimTypes.NameIdentifier)";if(n){const t=(new signalR.HubConnectionBuilder).withUrl("/notificationHub").build();try{await t.start();console.log("SignalR connection established.");await t.invoke("JoinChat",n);console.log(`User joined group: ${n}`);t.on("ReceiveNotification",function(n){alert(n);const t=document.createElement("div");t.classList.add("alert","alert-info","mt-2");t.textContent=n;document.body.appendChild(t)})}catch(t){console.error("Error connecting to SignalR:",t)}t.onclose(()=>{console.log("SignalR connection lost. Reconnecting...");try{await t.start();console.log("SignalR connection reestablished.");await t.invoke("JoinGroup",n)}catch(i){console.error("Error reconnecting to SignalR:",i)}})}});